<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">


<title>User Detail</title>

<!-- Bootstrap core CSS -->
<link rel="stylesheet"	href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">

<!-- font awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Custom styles for this template -->
<link href="css/shop-homepage.css" rel="stylesheet">
</head>


<body>

<!-- Navigation*(A) -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
		<div class="container">
			<a class="navbar-brand" th:href="@{/index}">Trendy Home Project</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse"
				data-target="#navbarResponsive" aria-controls="navbarResponsive"
				aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a th:if="${session.user == null}"
						class="nav-link" th:href="@{/login}">Login</a> <a
						th:if="${session.user != null}" class="nav-link"
						th:href="@{/logout}">Logout</a></li>
				</ul>
			</div>
		</div>
	</nav>
<!-- Navigation*(Z) -->

<!-- ------------------------------------------------------------------------------------------------------------ -->


<!-- Body(A) -->
<div class="row">

<!-- Body Left Side Category (A) -->
		<div class="col-lg-2">
			<h1 class="text-center"><br>
				<a th:href="@{/adminOrder}">Main</a></h1><br>
			<div class="list-group text-center">
					<a class="list-group-item" th:href="@{/adminOrder}">注文管理</a> 
					<a class="list-group-item" th:href="@{/admin}">商品検索</a> 
					<a class="list-group-item" th:href="@{/adminRegister}">商品登録</a> 
					<a class="list-group-item" th:href="@{/adminUser}">ユーザ検索</a>
					<a class="list-group-item" th:href="@{/adminMail}">メール送信</a>
			</div>
		</div>
<!-- Body Left Side Category (Z) -->


<!-- Body Right (A) -->
		<div class="col-lg-10">

			<!-- User Detail (A) -->
			<!-- <form th:action="@{/adminUserDetail2}" th:object="${suForm}" method="post"> -->
			<div class="row justify-content-center">
				<div class="col-10">
					<br>
					<br> 
					<h1 align="center">ユーザー詳細</h1>
					<br>
					<br>

	<!-- User detail (A) -->
					<table class="table text-center">
						<tr>
							<th rowspan="9" width="500"><img th:src="@{${'../user/'+userInfo.userId+'.jpg'}}" width=480 height=375;/></th>
						</tr>
						<tr>
							<th>Id</th>
							<th th:text="${userInfo.id}"></th>
						</tr>
						<tr>
							<th>UserId</th>
							<th th:text="${userInfo.userId}"></th>
						</tr>
						<tr>
							<th>Name</th>
							<th th:text="${userInfo.name}"></th>
						</tr>
						<tr>
							<th>Address</th>
							<th th:text="${userInfo.address}"></th>
						</tr>
						<tr>
							<th>Tel</th>
							<th th:text="${userInfo.tel}"></th>
						</tr>
						<tr>
							<th>Email</th>
							<th><a th:href="@{/adminMail(mail=${userInfo.email})}" th:text="${userInfo.email}"></a></th>
						</tr>
						<tr>
							<th>登録日</th>
							<th th:text="${userInfo.updDate}"></th>
						</tr>
					</table>
	<!-- User detail (Z) -->		

	<!-- 注文履歴 (A) -->
					<br> 
					<br>
					<h3>注文履歴</h3>
					<br>
					<table th:each="ss:${userSummary}" class="table text-center table-hover">
						<tr class="table-primary">
							<th>No</th>
							<th>注文番号</th>
							<th>総合計</th>
							<th>注文日</th>
							<th>詳細</th>
						</tr>
						<tr>
							<td th:text="${ssStat.count}"></td>
							<td th:text="${ss.id}"></td>
							<td th:text="${ss.totalPrice+'円'}"></td>
							<td th:text="${ss.updDate}"></td>
							<td>
								<table class="table text-center table-hover">
									<tr>
										<th>商品番号</th>
										<th>商品名</th>
										<th>価格</th>
										<th>数量</th>
										<th>合計</th>
									</tr>
									<tr th:each="aa:${userDetail}">
										<td th:if="${ss.id}==${aa.orderId}"
											th:text="${aa.productId}"></td>
										<td th:if="${ss.id}==${aa.orderId}"><a
											th:href="@{/adminProductDetail(id=${aa.productId})}"
											th:text="${aa.name}"></a></td>
										<td th:if="${ss.id}==${aa.orderId}"
											th:text="${aa.price+'円'}"></td>
										<td th:if="${ss.id}==${aa.orderId}"
											th:text="${aa.orderQuantity}"></td>
										<td th:if="${ss.id}==${aa.orderId}"
											th:text="${aa.totalPrice+'円'}"></td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
	<!-- 注文履歴 (Z) -->		
				
					<br> 
					<br>
				</div>
				<div class="col-1"></div>
			</div>
	<!-- User Detail (Z) -->
		
		</div>
<!-- Body Right (Z) -->
	
	</div>
<!-- Body(Z) -->

<!-- Footer (A) -->
	<footer class="py-5 bg-dark">
		<div class="container">
			<p class="m-0 text-center text-white">Copyright &copy; Your	Website 2017</p>
		</div>
	</footer>
<!-- Footer (Z) -->

<!-- Bootstrap core JavaScript -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
<script	src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>

</body>
</html>

<!--  주문이력 가져오는 left join sql (A)
SELECT d.order_id, d.product_id, p.name, p.price, d.order_quantity, p.price*d.order_quantity as totalPrice, d.upd_date FROM shop_order_detail d
LEFT JOIN shop_product p ON d.product_id=p.id 
LEFT JOIN shop_order o ON o.id=d.order_id 
LEFT JOIN shop_user u ON u.id=o.user_id 

GROUP BY d.order_id 
ORDER BY d.upd_date DESC;

WHERE u.id=#{id}
주문이력 가져오는 left join sql (Z) -->